# 样式定制指南

本文档介绍如何在使用 Ant Design X 和 Ant Design 的项目中自定义界面元素样式。

## 目录

1. [使用 antd-style 创建样式](#1-使用-antd-style-创建样式)
2. [使用 Ant Design Theme 定制主题](#2-使用-ant-design-theme-定制主题)
3. [使用全局 CSS 覆盖](#3-使用全局-css-覆盖)
4. [使用组件 styles 属性](#4-使用组件-styles-属性)
5. [使用 CSS Modules](#5-使用-css-modules)
6. [样式优先级说明](#6-样式优先级说明)

---

## 1. 使用 antd-style 创建样式

**当前项目使用的方式**，推荐用于组件级样式。

### 1.1 基本用法

在 `src/styles/useAppStyles.ts` 中：

```typescript
import { createStyles } from "antd-style";

export const useAppStyles = createStyles(({ token, css }) => {
  return {
    layout: css`
      width: 100%;
      height: 100vh;
      background: ${token.colorBgContainer};
      // 使用 token 访问主题变量
    `,
    customButton: css`
      background: ${token.colorPrimary};
      border-radius: ${token.borderRadius}px;
      padding: ${token.padding}px;
    `,
  };
});
```

### 1.2 在组件中使用

```typescript
import { useAppStyles } from "../styles/useAppStyles";

const MyComponent = () => {
  const { styles } = useAppStyles();

  return <div className={styles.layout}>内容</div>;
};
```

### 1.3 覆盖第三方组件样式

```typescript
export const useAppStyles = createStyles(({ token, css }) => {
  return {
    conversations: css`
      .ant-conversations-list {
        padding-inline-start: 0; // 覆盖 Ant Design X 默认样式
      }
      .ant-conversations-item:hover {
        background: ${token.colorPrimaryBg};
      }
    `,
  };
});
```

**优点**：

- ✅ 类型安全
- ✅ 支持主题变量（token）
- ✅ 自动处理 CSS-in-JS
- ✅ 支持嵌套选择器

---

## 2. 使用 Ant Design Theme 定制主题

适用于全局主题定制，影响所有 Ant Design 组件。

### 2.1 配置主题

在 `src/App.tsx` 或 `src/main.tsx` 中：

```typescript
import { ConfigProvider } from "antd";
import { XProvider } from "@ant-design/x";

const App = () => {
  return (
    <ConfigProvider
      theme={{
        token: {
          // 全局颜色
          colorPrimary: "#1890ff",
          colorSuccess: "#52c41a",
          colorWarning: "#faad14",
          colorError: "#f5222d",

          // 圆角
          borderRadius: 6,

          // 字体
          fontFamily: "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto",
          fontSize: 14,

          // 间距
          padding: 16,
          margin: 16,
        },
        components: {
          // 定制特定组件
          Button: {
            borderRadius: 4,
            primaryColor: "#fff",
          },
          Input: {
            borderRadius: 4,
          },
        },
      }}
    >
      <XProvider locale={locale}>
        {/* 你的应用 */}
      </XProvider>
    </ConfigProvider>
  );
};
```

### 2.2 在样式中使用主题变量

```typescript
export const useAppStyles = createStyles(({ token, css }) => {
  return {
    button: css`
      background: ${token.colorPrimary}; // 使用主题变量
      border-radius: ${token.borderRadius}px;
    `,
  };
});
```

**优点**：

- ✅ 全局统一主题
- ✅ 支持暗色模式
- ✅ 所有组件自动应用

---

## 3. 使用全局 CSS 覆盖

适用于需要覆盖第三方组件默认样式的情况。

### 3.1 创建全局样式文件

创建 `src/styles/global.css`：

```css
/* 覆盖 Ant Design X 组件样式 */
.ant-conversations-list {
  padding-inline-start: 0 !important;
}

.ant-bubble {
  max-width: 840px;
}

.ant-bubble-content {
  padding: 12px 16px;
}

/* 自定义滚动条 */
.ant-conversations-list::-webkit-scrollbar {
  width: 6px;
}

.ant-conversations-list::-webkit-scrollbar-track {
  background: #f1f1f1;
}

.ant-conversations-list::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 3px;
}
```

### 3.2 在入口文件导入

在 `src/main.tsx` 或 `src/App.tsx` 中：

```typescript
import "./styles/global.css";
```

**优点**：

- ✅ 简单直接
- ✅ 可以覆盖任何样式
- ✅ 支持伪元素和伪类

**注意**：

- ⚠️ 需要使用 `!important` 提高优先级
- ⚠️ 可能影响全局样式

---

## 4. 使用组件 styles 属性

Ant Design X 和 Ant Design 组件支持 `styles` 属性进行样式定制。

### 4.1 Ant Design X 组件

```typescript
import { Conversations, Bubble } from "@ant-design/x";

// Conversations 组件
<Conversations
  styles={{
    item: {
      padding: "8px 12px",
      borderRadius: "8px",
    },
    list: {
      padding: "0",
    },
  }}
/>

// Bubble 组件
<Bubble.List
  styles={{
    root: {
      marginBlockEnd: 24,
    },
    bubble: {
      maxWidth: 840,
      borderRadius: "12px",
    },
  }}
/>
```

### 4.2 Ant Design 组件

```typescript
import { Button, Input } from "antd";

<Button
  styles={{
    root: {
      borderRadius: "8px",
    },
  }}
>
  按钮
</Button>

<Input
  styles={{
    input: {
      borderRadius: "4px",
    },
  }}
/>
```

**优点**：

- ✅ 类型安全
- ✅ 组件级别定制
- ✅ 不需要全局样式

---

## 5. 使用 CSS Modules

适用于需要局部作用域的样式。

### 5.1 创建样式文件

创建 `src/components/Sidebar/Sidebar.module.css`：

```css
.sidebar {
  width: 280px;
  background: #f5f5f5;
}

.logo {
  display: flex;
  align-items: center;
  gap: 8px;
}

.logo span {
  font-weight: bold;
  font-size: 16px;
}
```

### 5.2 在组件中使用

```typescript
import styles from "./Sidebar.module.css";

const Sidebar = () => {
  return (
    <div className={styles.sidebar}>
      <div className={styles.logo}>
        <span>Logo</span>
      </div>
    </div>
  );
};
```

**优点**：

- ✅ 局部作用域，避免样式冲突
- ✅ 支持 CSS 所有特性
- ✅ 构建时优化

---

## 6. 样式优先级说明

样式应用的优先级（从高到低）：

1. **内联样式** (`style` 属性)
2. **组件 styles 属性** (Ant Design X/Ant Design)
3. **CSS Modules / antd-style** (通过 className)
4. **全局 CSS** (通过类名选择器)
5. **主题配置** (ConfigProvider theme)

### 6.1 推荐实践

```typescript
// ✅ 推荐：使用 antd-style + token
const { styles } = useAppStyles();
<div className={styles.layout} />

// ✅ 推荐：使用组件 styles 属性
<Conversations styles={{ item: { padding: "8px" } }} />

// ✅ 推荐：全局主题定制
<ConfigProvider theme={{ token: { colorPrimary: "#1890ff" } }} />

// ⚠️ 谨慎使用：全局 CSS 覆盖
.ant-conversations-list { padding: 0 !important; }
```

---

## 7. 实际示例

### 7.1 定制侧边栏样式

**方法 1：修改 `useAppStyles.ts`**

```typescript
export const useAppStyles = createStyles(({ token, css }) => {
  return {
    side: css`
      background: ${token.colorBgLayout};
      width: 300px; // 修改宽度
      border-right: 1px solid ${token.colorBorder};

      .ant-conversations-item {
        border-radius: 8px;
        margin-bottom: 4px;

        &:hover {
          background: ${token.colorPrimaryBg};
        }
      }
    `,
  };
});
```

**方法 2：使用组件 styles 属性**

```typescript
<Conversations
  styles={{
    item: {
      padding: "12px 16px",
      borderRadius: "8px",
      marginBottom: "4px",
    },
  }}
/>
```

### 7.2 定制消息气泡样式

```typescript
// 在 bubbleRole.tsx 中
<XMarkdown
  className={className}
  style={{
    padding: "16px",
    borderRadius: "12px",
    background: token.colorBgContainer,
  }}
>
  {newContent}
</XMarkdown>
```

### 7.3 定制发送器样式

```typescript
<Sender
  styles={{
    root: {
      borderRadius: "12px",
      border: `1px solid ${token.colorBorder}`,
    },
    textarea: {
      borderRadius: "8px",
    },
  }}
/>
```

---

## 8. 调试样式

### 8.1 使用浏览器开发者工具

1. 打开 Chrome DevTools (F12)
2. 使用元素选择器找到目标元素
3. 查看应用的样式类名（通常是 `.ant-*` 开头）
4. 在 Elements 面板中直接修改样式测试

### 8.2 查找组件类名

Ant Design X 组件类名规则：

- `ant-conversations-*` - Conversations 组件
- `ant-bubble-*` - Bubble 组件
- `ant-sender-*` - Sender 组件
- `ant-x-markdown-*` - XMarkdown 组件

### 8.3 使用 React DevTools

安装 React DevTools 扩展，可以查看组件的 props 和状态。

---

## 9. 常见问题

### Q1: 样式不生效怎么办？

**检查优先级**：

1. 确认没有更高优先级的样式覆盖
2. 检查是否需要使用 `!important`
3. 确认选择器是否正确

**解决方案**：

```css
/* 提高优先级 */
.my-custom-class.ant-conversations-item {
  padding: 12px !important;
}
```

### Q2: 如何实现暗色模式？

使用 Ant Design 的主题系统：

```typescript
import { ConfigProvider, theme } from "antd";

const { darkAlgorithm } = theme;

<ConfigProvider
  theme={{
    algorithm: darkAlgorithm, // 使用暗色算法
    token: {
      colorBgContainer: "#141414",
      colorText: "#fff",
    },
  }}
>
  {/* 你的应用 */}
</ConfigProvider>
```

### Q3: 如何定制特定组件的样式？

**推荐使用 styles 属性**：

```typescript
<Conversations
  styles={{
    item: {
      // 只影响 Conversations 的 item
    },
  }}
/>
```

---

## 10. 最佳实践总结

1. ✅ **优先使用 antd-style**：类型安全，支持主题变量
2. ✅ **使用组件 styles 属性**：组件级别定制，无需全局样式
3. ✅ **全局主题使用 ConfigProvider**：统一品牌风格
4. ✅ **谨慎使用全局 CSS**：仅在必要时使用，避免样式冲突
5. ✅ **利用 token 系统**：保持与主题一致

---

**相关文件**：

- `src/styles/useAppStyles.ts` - 当前样式定义
- `src/App.tsx` - 应用入口，可添加 ConfigProvider
- `src/index.css` - 全局样式文件

**参考文档**：

- [Ant Design 主题定制](https://ant.design/docs/react/customize-theme-cn)
- [antd-style 文档](https://ant-design.github.io/antd-style/)
- [Ant Design X 组件文档](https://x.ant.design/components/overview)
